<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Audience Analyzer — Fabric AI PoC</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Inter', sans-serif;
    }
  </style>
</head>

<body class="min-h-screen bg-black text-white">

  <!-- HEADER -->
  <header class="max-w-6xl mx-auto px-6 py-10 text-center">
    <img
      src="https://framerusercontent.com/assets/YhHtO4AfpyCgmWFZ6i3dcmRLcAI.png"
      alt="Fabric"
      class="h-10 mx-auto mb-6"
    />
    <h1 class="text-4xl font-extrabold mb-3">
      TMDB Audience Analyzer
    </h1>
    <p class="text-gray-400 max-w-2xl mx-auto">
      Proof of Concept — Automated demographic and psychographic inference
      from TMDB metadata using LLMs.
    </p>
  </header>

  <!-- INPUT -->
  <section class="max-w-3xl mx-auto px-6">
    <div class="bg-gray-900 border border-gray-800 rounded-lg p-6 space-y-4">
      <label class="block text-sm font-semibold text-cyan-400">
        TMDB Content URL
      </label>
      <input
        id="tmdbUrl"
        type="text"
        placeholder="https://www.themoviedb.org/tv/106379-fallout"
        class="w-full bg-black border border-gray-700 rounded-md px-4 py-2 text-sm font-mono text-white focus:outline-none focus:border-cyan-500"
      />

      <button
        id="analyzeBtn"
        class="mt-4 w-full bg-gradient-to-r from-cyan-500 to-purple-600 hover:from-cyan-600 hover:to-purple-700 transition-all rounded-md py-3 font-semibold"
      >
        Analyze Content
      </button>
    </div>
  </section>

  <!-- RESULTS -->
  <section id="results" class="max-w-6xl mx-auto px-6 py-10">
    <div class="text-center text-gray-500 text-sm">
      Paste a TMDB URL and click “Analyze Content”.
    </div>
  </section>

  <!-- SCRIPT -->
  <script>
    const API_ENDPOINT =
      "https://375sxpkkd5.execute-api.us-east-1.amazonaws.com/prod/analyze";

    const analyzeBtn = document.getElementById("analyzeBtn");
    const resultsDiv = document.getElementById("results");

    analyzeBtn.addEventListener("click", async () => {
      const tmdbUrl = document.getElementById("tmdbUrl").value.trim();

      if (!tmdbUrl) {
        resultsDiv.innerHTML = `
          <div class="text-center text-red-400">
            Please enter a TMDB URL.
          </div>`;
        return;
      }

      resultsDiv.innerHTML = `
        <div class="text-center text-gray-400">
          Analyzing content…
        </div>`;

      try {
        const response = await fetch(API_ENDPOINT, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ tmdb_url: tmdbUrl })
        });

        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.error || "API error");
        }

        renderResult(data);

      } catch (err) {
        resultsDiv.innerHTML = `
          <div class="bg-red-500/10 border border-red-500/30 rounded-lg p-4 text-red-400">
            ${err.message}
          </div>`;
      }
    });

    function renderResult(data) {
      const m = data.metadata;
      const a = data.audience;

      resultsDiv.innerHTML = `
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
          <div>
            <img
              src="${m.poster}"
              class="rounded-lg border border-gray-700 shadow-lg"
            />
          </div>

          <div class="md:col-span-2 space-y-4">
            <h2 class="text-3xl font-bold">
              ${m.title} <span class="text-gray-400 text-xl">(${m.year})</span>
            </h2>

            <p class="text-sm text-cyan-400 uppercase tracking-wide">
              ${m.type} · ${m.genres}
            </p>

            <p class="text-gray-300 text-sm leading-relaxed">
              ${m.synopsis}
            </p>

            <div class="text-xs text-gray-400 space-y-1">
              <div><strong>Cast:</strong> ${m.cast}</div>
              <div><strong>Directors:</strong> ${m.directors}</div>
              <div><strong>Keywords:</strong> ${m.keywords}</div>
            </div>

            <div class="pt-4">
              <h3 class="text-sm font-semibold text-purple-400 mb-1">
                Psychographic Profile
              </h3>
              <p class="text-gray-300 text-sm">
                ${a.psychographic_profile}
              </p>
            </div>

            <div class="pt-3 text-xs text-gray-400">
              <strong>Brand affinities:</strong> ${a.brand_affinities.join(", ")}<br/>
              <strong>Emotional tone:</strong> ${a.emotional_tone}<br/>
              <strong>IAB category:</strong> ${a.iab_content_category}<br/>
              <strong>Confidence:</strong> ${(a.confidence * 100).toFixed(0)}%
            </div>
          </div>
        </div>

        <div class="mt-12 bg-gray-900 border border-gray-800 rounded-lg p-6">
          <h3 class="text-lg font-semibold mb-4">
            Demographic Distribution
          </h3>
          <canvas id="demographicRadar"></canvas>
        </div>
      `;

      renderRadar(a.demographic_distribution);
    }

    function renderRadar(dist) {
      const labels = Object.keys(dist);
      const values = Object.values(dist);

      new Chart(document.getElementById("demographicRadar"), {
        type: "radar",
        data: {
          labels: labels,
          datasets: [{
            label: "Audience share",
            data: values,
            fill: true,
            backgroundColor: "rgba(168, 85, 247, 0.2)",
            borderColor: "rgba(168, 85, 247, 1)",
            pointBackgroundColor: "rgba(34, 211, 238, 1)"
          }]
        },
        options: {
          scales: {
            r: {
              min: 0,
              max: 1,
              ticks: {
                display: false
              },
              grid: {
                color: "rgba(255,255,255,0.1)"
              },
              angleLines: {
                color: "rgba(255,255,255,0.1)"
              },
              pointLabels: {
                color: "#9CA3AF",
                font: {
                  size: 11
                }
              }
            }
          },
          plugins: {
            legend: {
              display: false
            }
          }
        }
      });
    }
  </script>

</body>
</html>
